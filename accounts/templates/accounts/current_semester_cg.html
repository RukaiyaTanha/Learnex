{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Current Semester CG - AIUB</title>
  <link rel="stylesheet" href="{% static 'accounts/cgpa_calculator.css' %}" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .course-row {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .course-row label {
      width: 100px;
      font-weight: 500;
    }
    .course-row input, .course-row select {
      flex: 1;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
      background-color: #f9f9f9;
      transition: all 0.3s ease;
    }
    .course-row input:focus, .course-row select:focus {
      outline: none;
      border-color: #2575fc;
      box-shadow: 0 0 5px rgba(37, 117, 252, 0.5);
    }
    #calculateBtn, #addCourseBtn {
      margin-top: 10px;
    }
  </style>
</head>
<body>
<div class="container">
  <header>
    <h1>Hi {{ request.user.username }}, Calculate Current Semester CG</h1>
    <p>Select your grade and enter credits for each course.</p>
  </header>

  <div id="courses-container"></div>

  <button id="addCourseBtn">Add Course</button>
  <button id="calculateBtn">Calculate CG</button>

  <div class="result" id="result"></div>

  <div class="navigation-footer">
    <a href="{% url 'student_dashboard' %}" class="nav-link"><i class="fas fa-home"></i><span>Home</span></a>
    <a href="{% url 'calculate_cgpa_page' %}" class="nav-link"><i class="fas fa-calculator"></i><span>Total Semester CG</span></a>
    <a href="#" class="nav-link"><i class="fas fa-chart-bar"></i><span>Progress</span></a>
    <a href="#" class="nav-link"><i class="fas fa-cog"></i><span>Settings</span></a>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const container = document.getElementById("courses-container");
  const addBtn = document.getElementById("addCourseBtn");
  const calcBtn = document.getElementById("calculateBtn");
  const resultDiv = document.getElementById("result");

  const GRADE_POINTS = {
    "A+": 4.00, "A": 3.75, "B+": 3.50, "B": 3.25,
    "C+": 3.00, "C": 2.75, "D+": 2.50, "D": 2.25, "F": 0.00
  };

  let courseCount = 0;

  function addCourseRow() {
    courseCount++;
    const div = document.createElement("div");
    div.classList.add("course-row");
    div.innerHTML = `
      <label>Course ${courseCount}:</label>
      <select class="grade-select" required>
        <option value="" disabled selected>Grade</option>
        ${Object.keys(GRADE_POINTS).map(g => `<option value="${g}">${g}</option>`).join('')}
      </select>
      <input type="number" class="credits-input" placeholder="Credits" min="0" step="0.1" required>
    `;
    container.appendChild(div);
  }

  addBtn.addEventListener("click", addCourseRow);

  calcBtn.addEventListener("click", () => {
    const rows = document.querySelectorAll(".course-row");
    if (rows.length === 0) { alert("Please add at least one course"); return; }

    let totalPoints = 0, totalCredits = 0;

    rows.forEach(row => {
      const grade = row.querySelector(".grade-select").value;
      const credits = parseFloat(row.querySelector(".credits-input").value);
      if (GRADE_POINTS[grade] !== undefined && !isNaN(credits) && credits > 0) {
        totalPoints += GRADE_POINTS[grade] * credits;
        totalCredits += credits;
      }
    });

    const cg = totalCredits > 0 ? (totalPoints / totalCredits).toFixed(2) : "0.00";

    resultDiv.innerHTML = `
      <div class="cgpa-result-card">
        <p><strong>Total Credits:</strong> ${totalCredits}</p>
        <p><strong>Current Semester CG:</strong> ${cg}</p>
      </div>
    `;
  });

  addCourseRow(); 
});
</script>
</body>
</html>
